<div class="quote-wrapper" *ngIf="quote() as q">
  <header class="app-header">Lumina</header>

  <div class="quote-container">
    <!-- Quote Text -->
    <div class="quote-content">
      <div class="quote-number">#{{ quote()?.number }}</div>
      <div class="quote-graphic">
        <span class="line"></span>
        <i class="fa-solid fa-quote-left"></i>
        <span class="line"></span>
      </div>
      <p class="quote-text" [@fadeAnimation]="quote()?.id">
        {{ quote()?.content }}
      </p>
      <p class="quote-author" [class.active]="(activeAuthor$ | async) === q.author" (click)="toggleAuthor(q.author)"
        [attr.title]="(activeAuthor$ | async) === q.author ? 'Unlock author' : 'Lock to this author'">
        {{ q.author }}
        <i class="fa-solid fa-lock" *ngIf="(activeAuthor$ | async) === q.author"
          style="font-size: 0.6em; margin-left: 6px; vertical-align: middle;"></i>
      </p>
      <div class="quote-categories">
        <span *ngFor="let cat of q.categories" class="hashtag" [class.active]="(activeCategory$ | async) === cat"
          (click)="toggleCategory(cat)"
          [attr.title]="(activeCategory$ | async) === cat ? 'Unlock category' : 'Lock to this category'">
          #{{ cat }} <span class="count">({{ categoryCounts()[cat] || 0 }})</span>
          <i class="fa-solid fa-lock" *ngIf="(activeCategory$ | async) === cat"
            style="font-size: 0.7em; margin-left: 4px;"></i>
        </span>
      </div>
    </div>

    <!-- Next Quote Button -->
    <div class="next-button-wrapper">
      <button class="btn-next" (click)="loadNewQuote()">
        Next quote <i class="fa-solid fa-arrow-right"></i>
      </button>
    </div>

    <!-- Icon Bar -->
    <div class="icon-bar">
      <!-- Theme Toggle -->
      <button (click)="themeService.toggleTheme()" class="btn-icon" [attr.data-tooltip]="
          themeService.isDarkMode()
            ? 'Switch to Light Mode'
            : 'Switch to Dark Mode'
        ">
        <i class="fa-solid" [ngClass]="themeService.isDarkMode() ? 'fa-sun' : 'fa-moon'"></i>
      </button>

      <!-- Filter Toggle -->
      <button (click)="toggleFilter()" class="btn-icon" data-tooltip="Browse Categories"
        [class.active]="(activeCategory$ | async) || (activeAuthor$ | async)">
        <i class="fa-solid fa-filter"></i>
      </button>

      <!-- Share Menu -->
      <button (click)="toggleLike()" class="btn-icon" [class.active]="isLiked()"
        [attr.data-tooltip]="isLiked() ? 'Unlike' : 'Like'">
        <i [class]="isLiked() ? 'fa-solid fa-heart' : 'fa-regular fa-heart'"></i>
      </button>

      <!-- Bookmark Button -->
      <button (click)="toggleBookmark()" class="btn-icon" [class.active]="isBookmarked()"
        [attr.data-tooltip]="isBookmarked() ? 'Remove Bookmark' : 'Bookmark'">
        <i [class]="isBookmarked() ? 'fa-solid fa-bookmark' : 'fa-regular fa-bookmark'"></i>
      </button>

      <!-- Share Menu -->
      <div class="share-wrapper">
        <button (click)="toggleShareMenu($event)" class="btn-icon" data-tooltip="Share Quote"
          [class.active]="isShareMenuOpen()">
          <i class="fa-solid fa-share"></i>
        </button>

        <div class="share-menu" *ngIf="isShareMenuOpen()" (click)="$event.stopPropagation()">
          <button (click)="copyLink(); toggleShareMenu()">
            <i class="fa-solid fa-link"></i> Copy Link
          </button>
          <button (click)="shareOnTwitter(); toggleShareMenu()">
            <i class="fa-brands fa-x-twitter"></i> Post to X
          </button>
          <button (click)="shareOnInstagram(); toggleShareMenu()">
            <i class="fa-brands fa-instagram"></i> Post to
            Instagram
          </button>
          <button (click)="shareOnPinterest(); toggleShareMenu()">
            <i class="fa-brands fa-pinterest"></i> Post to
            Pinterest
          </button>
        </div>
      </div>

      <!-- Wallpaper Download -->
      <button (click)="downloadWallpaper()" class="btn-icon" data-tooltip="Download Wallpaper">
        <i class="fa-solid fa-arrow-down"></i>
      </button>

      <!-- Fullscreen Toggle -->
      <button (click)="toggleFullscreen()" class="btn-fullscreen" [attr.data-tooltip]="
          isFullscreen() ? 'Exit Fullscreen' : 'Enter Fullscreen'
        ">
        <i class="fa-solid" [ngClass]="isFullscreen() ? 'fa-compress' : 'fa-expand'"></i>
      </button>

      <!-- Info Toggle -->
      <button (click)="toggleInfo()" class="btn-icon" data-tooltip="Quote Details" [class.active]="isInfoOpen()">
        <i class="fa-solid fa-circle-info"></i>
      </button>

      <!-- Report Issue Button -->
      <a [routerLink]="['/report-issue']" [queryParams]="{quoteId: quote()?.id, quoteNum: quote()?.number}"
        class="btn-icon" data-tooltip="Report Issue">
        <i class="fa-solid fa-triangle-exclamation"></i>
      </a>
    </div>
  </div>

  <footer class="footer">
    <span class="copyright">&copy; {{ currentYear }} jtp-development</span>
    <span class="divider">|</span>
    <a routerLink="/about">about</a>
    <span class="divider">|</span>
    <a routerLink="/contact">contact</a>
    <span class="divider">|</span>
    <a routerLink="/submit">submit a quote</a>
    <span class="divider">|</span>
    <a routerLink="/privacy">privacy policy</a>
  </footer>

  <!-- Category Overlay -->
  <div class="category-overlay-backdrop" *ngIf="isFilterOpen()" (click)="closeFilter()">
    <div class="category-overlay-content" (click)="$event.stopPropagation()">
      <div class="overlay-header">
        <h2>Explore</h2>
        <button class="btn-close" (click)="closeFilter()">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>

      <div class="filter-tabs">
        <button class="tab-btn" [class.active]="filterMode() === 'categories'"
          (click)="setFilterMode('categories')">Categories</button>
        <button class="tab-btn" [class.active]="filterMode() === 'authors'"
          (click)="setFilterMode('authors')">Authors</button>
      </div>

      <div class="category-grid" *ngIf="filterMode() === 'categories'">
        <span class="hashtag" [class.active]="(activeCategory$ | async) === null" (click)="selectCategory(null!)"
          style="justify-content: center;">
          All Categories
        </span>
        <span *ngFor="let cat of allCategories$ | async" class="hashtag"
          [class.active]="(activeCategory$ | async) === cat" (click)="selectCategory(cat)">
          #{{ cat }} <span class="count">({{ categoryCounts()[cat] || 0 }})</span>
          <i class="fa-solid fa-lock" *ngIf="(activeCategory$ | async) === cat"
            style="font-size: 0.7em; margin-left: 4px;"></i>
        </span>
      </div>

      <div class="category-grid" *ngIf="filterMode() === 'authors'">
        <span class="hashtag" [class.active]="(activeAuthor$ | async) === null" (click)="selectAuthor(null!)"
          style="justify-content: center;">
          All Authors
        </span>
        <span *ngFor="let auth of allAuthors$ | async" class="hashtag author-tag"
          [class.active]="(activeAuthor$ | async) === auth" (click)="selectAuthor(auth)">
          {{ auth }} <span class="count">({{ authorCounts()[auth] || 0 }})</span>
          <i class="fa-solid fa-lock" *ngIf="(activeAuthor$ | async) === auth"
            style="font-size: 0.7em; margin-left: 4px;"></i>
        </span>
      </div>
    </div>
  </div>

  <!-- Info Overlay -->
  <div class="category-overlay-backdrop info-overlay" *ngIf="isInfoOpen()" (click)="closeInfo()">
    <div class="category-overlay-content info-content" (click)="$event.stopPropagation()">
      <div class="overlay-header">
        <h2>Quote Details</h2>
        <button class="btn-close" (click)="closeInfo()">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>

      <div class="info-body">
        <div class="info-quote-preview">
          <span class="preview-number">#{{ quote()?.number }}</span>
          <p class="preview-text">"{{ quote()?.content }}"</p>
          <p class="preview-author">â€” {{ quote()?.author }}</p>
        </div>

        <p class="post-date">Posted {{ mockDate }}</p>

        <div class="stats-grid">
          <div class="stat-item">
            <span class="label">Views</span>
            <span class="value">{{ mockViews | number }}</span>
          </div>
          <div class="stat-item">
            <span class="label">Saves</span>
            <span class="value">{{ mockSaves | number }}</span>
          </div>
          <div class="stat-item">
            <span class="label">Likes</span>
            <span class="value">{{ mockLikes | number }}</span>
          </div>
        </div>

        <div class="tags-section">
          <h3>Tags</h3>
          <div class="category-grid">
            <span *ngFor="let cat of quote()?.categories" class="hashtag"
              [class.active]="(activeCategory$ | async) === cat" (click)="toggleCategory(cat); closeInfo()">
              #{{ cat }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>